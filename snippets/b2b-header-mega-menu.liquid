<style>
.b2b-collections-menu.loading {
  opacity: 0.3;
  pointer-events: none;
  position: relative;
}
.b2b-menu-placeholder {
  display: block;
  text-align: center;
  padding: 1em;
  font-size: 1.1em;
  color: #616161;
  background: rgba(255,255,255,0.8);
  position: absolute;
  left: 0; right: 0; top: 0;
  z-index: 10;
}
</style>

<div style="position:relative">
  <span class="b2b-menu-placeholder">Checking available collectionsâ€¦</span>

  <ul class="b2b-collections-menu loading">
    {% for parent_link in linklists['main-menu'].links %}
      <li>
        <a href="{{ parent_link.url }}">{{ parent_link.title }}</a>
        {% if parent_link.links.size > 0 %}
          <ul>
            {% for child_link in parent_link.links %}
              <li>
                <a href="{{ child_link.url }}">{{ child_link.title }}</a>
                {% if child_link.links.size > 0 %}
                  <ul>
                    {% for grandchild_link in child_link.links %}
                      <li>
                        <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</div>

<script>
(function(){
  var menu = document.querySelector('.b2b-collections-menu');
  var placeholder = document.querySelector('.b2b-menu-placeholder');
  if (!menu) return;

  // Gather all collection links (you may refine to only .collection_link links if you want)
  var links = Array.prototype.slice.call(menu.querySelectorAll('a[href*="/collections/"]'));
  var total = links.length, checked = 0;

  if(!total) {
    if (menu) menu.classList.remove('loading');
    if (placeholder) placeholder.remove();
    return;
  }

  links.forEach(function(link){
    fetch(link.href)
      .then(function(response) { return response.text(); })
      .then(function(html) {
        // Change the two phrases below as needed for your theme/language
        if(html.includes('No products found') || html.includes('no products available')) {
          // Hide the <li> container, if possible!
          if(link.parentElement && link.parentElement.tagName === "LI") {
            link.parentElement.style.display = "none";
          }
        }
      })
      .catch(function(){ /* Ignore errors */ })
      .finally(function(){
        checked++;
        if(checked === total) {
          menu.classList.remove('loading');
          if (placeholder) placeholder.remove();
        }
      });
  });
})();
</script>